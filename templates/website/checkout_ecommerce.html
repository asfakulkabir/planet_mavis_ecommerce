{% extends "_base/_base.html" %}

{% block title %}Checkout{% endblock %}

{% block content %}

<section class="text-gray-800 dark:text-gray-200">
    <div class="container px-5 py-10 mx-auto">
        <h2 class="text-3xl font-semibold text-gray-900 dark:text-white mb-6">Checkout</h2>

        <div class="grid md:grid-cols-2 gap-8">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-medium text-gray-900 dark:text-white mb-4">Your Cart</h3>
                <div id="cart-items">
                    <ul id="cart-items-list" class="text-gray-600 dark:text-gray-400"></ul>
                </div>
                <p class="text-lg font-semibold text-gray-900 dark:text-white mt-4">
                    Subtotal: <span id="cart-subtotal" class="text-lime-600 dark:text-lime-400">à§³0</span>
                </p>
            </div>

            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-medium text-gray-900 dark:text-white mb-4">Billing Details</h3>
                <form method="POST" id="checkout-form">
                    {% csrf_token %}
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-200">Full Name</label>
                            <input type="text" name="customer_name" required
                                class="w-full p-3 border border-gray-300 dark:border-gray-500 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-teal-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-200">Phone Number</label>
                            <input type="tel" 
                                name="customer_phone_number" 
                                id="customer_phone_number"
                                pattern="^(?:\+?88)?01[3-9]\d{8}$"
                                title="Enter a valid Bangladeshi phone number (e.g., 017xxxxxxxx, +88017xxxxxxxx, 88017xxxxxxxx)"
                                required
                                class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none                       focus:ring-2 focus:ring-teal-500">
                            <p id="phone-error" class="hidden text-red-500 text-sm mt-1">Invalid Bangladeshi phone number.</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-200">Full Address</label>
                            <textarea name="customer_address" required
                                class="w-full p-3 border border-gray-300 dark:border-gray-500 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-teal-500 h-20"></textarea>
                        </div>

                        <div class="form-group text-gray-700 dark:text-gray-200">
                            <label for="delivery_zone" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Select Delivery Zone:</label>
                            {% for zone in delivery_zones %}
                                <div class="mt-2">
                                    <input type="radio" name="delivery_zone" value="{{ zone.zone }}" id="zone_{{ forloop.counter }}" 
                                        data-charge="{{ zone.charge }}" {% if forloop.first %}checked{% endif %}
                                        class="mr-2 delivery-zone-radio">
                                    <label for="zone_{{ forloop.counter }}">{{ zone.zone }} (à§³{{ zone.charge }})</label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <input type="hidden" name="cart_items" id="cart-items-json">

                    <div class="bg-lime-50 dark:bg-green-950 p-2 rounded-lg border border-lime-500 dark:border-green-700 mt-2">
                    <p class="text-lg font-semibold text-gray-900 dark:text-white mt-1">
                        Delivery Charge: <span id="delivery-charge" class="text-red-500 dark:text-yellow-400">à§³0</span>
                    </p>
                    <p class="text-lg font-semibold text-gray-900 dark:text-white mt-1">
                        Grand Total: <span id="grand-total" class="text-red-500 dark:text-yellow-400">à§³0</span>
                    </p>
                    </div>

<div class="mt-2">
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-200">Select Payment Method</label>
    <div class="mt-2 space-y-2">
        <div class="flex items-center">
            <input type="radio" id="cod" name="payment_method" value="cod" checked
                class="h-4 w-4 text-teal-600 border-gray-300 dark:border-gray-600 focus:ring-teal-500">
            <label for="cod" class="ml-2 block text-sm text-gray-700 dark:text-gray-200">Cash on Delivery</label>
        </div>
        <div class="flex items-center">
            <input type="radio" id="bkash" name="payment_method" value="bkash"
                class="h-4 w-4 text-teal-600 border-gray-300 dark:border-gray-600 focus:ring-teal-500">
            <label for="bkash" class="ml-2 block text-sm text-gray-700 dark:text-gray-200">Pay by bKash Personal </label>
        </div>
    </div>
</div>
<div id="bkash-details" class="mt-4 hidden">
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-200">Bkash Transaction ID <span id="copy-number" class="text-red-500 dark:text-lime-300"> 01711582834 </span><span id="copy-status" class="ml-2 text-sm text-rose-500 hidden">Copied! </span>Personal (send Money)</label>
    <input type="text" name="bkash_trx_id" id="bkash-trx-id-input"
        class="w-full p-3 border border-gray-300 dark:border-gray-500 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-teal-500">
    <label class="block text-sm font-medium text-rose-700 dark:text-rose-400 mt-2">**You have to pay advance delivery charge for Outside Dhaka</label>
</div>

                    <button type="submit" id="order-button"
                    class="mt-6 w-full bg-teal-600 text-white py-3 rounded-md text-lg font-semibold hover:bg-teal-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed">
                    Place Order
                </button>
                </form>
            </div>
        </div>
    </div>
</section>


<script>
document.addEventListener('DOMContentLoaded', function () {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];

    // ðŸš¨ If cart is empty, redirect to shop with a message
    if (cart.length === 0) {
        alert("Your cart is empty. Redirecting to shop...");
        window.location.href = "{% url 'website:shop' %}";
        return; // stop the rest of the script
    }

    const cartItemsList = document.getElementById('cart-items-list');
    const cartSubtotalElement = document.getElementById('cart-subtotal');
    const deliveryChargeElement = document.getElementById('delivery-charge');
    const grandTotalElement = document.getElementById('grand-total');
    const checkoutForm = document.getElementById('checkout-form');
    const cartItemsJsonInput = document.getElementById('cart-items-json');
    const deliveryZoneRadios = document.querySelectorAll('.delivery-zone-radio');

    let subtotal = 0;

    // Render cart items
    cart.forEach(item => {
        const li = document.createElement('li');
        li.classList.add('flex', 'justify-between', 'items-center', 'border-b', 'py-3');
        li.innerHTML = `
            <div class="flex items-center">
                <img src="${item.image ? item.image : '/static/icons/default-image.webp'}" alt="${item.name}" class="w-16 h-16 object-cover object-top mr-4">
                <div>
                    <p class="font-semibold text-gray-900 dark:text-gray-50">${item.name}</p>
                    <p class="text-sm text-gray-600 dark:text-gray-200">${Object.entries(item.variation).map(([key, value]) => `${key}: ${value}`).join(', ')}</p>
                </div>
            </div>
            <p class="font-semibold dark:text-white">à§³${item.price}<span class="text-lime-800 dark:text-lime-400 text-xs"> x ${item.quantity}</span> </p>
        `;
        cartItemsList.appendChild(li);
        subtotal += item.price * item.quantity;
    });

    // Set initial subtotal
    cartSubtotalElement.textContent = `à§³${subtotal.toFixed(2)}`;

    function updateTotals() {
        const selectedZone = document.querySelector('input[name="delivery_zone"]:checked');
        const deliveryCharge = selectedZone ? parseFloat(selectedZone.dataset.charge) : 0;
        const grandTotal = subtotal + deliveryCharge;

        deliveryChargeElement.textContent = `à§³${deliveryCharge.toFixed(2)}`;
        grandTotalElement.textContent = `à§³${grandTotal.toFixed(2)}`;
    }

    deliveryZoneRadios.forEach(radio => radio.addEventListener('change', updateTotals));
    updateTotals();

    checkoutForm.addEventListener('submit', function (e) {
        e.preventDefault();
        cartItemsJsonInput.value = JSON.stringify(cart);
        this.submit();
        localStorage.removeItem('cart');
    });
});
</script>

<!-- copy  -->
<script>
document.getElementById('copy-number').addEventListener('click', function () {
    const number = this.textContent.trim();
    navigator.clipboard.writeText(number).then(() => {
        const status = document.getElementById('copy-status');
        status.classList.remove('hidden');
        setTimeout(() => status.classList.add('hidden'), 2000); // hide after 2 sec
    }).catch(err => {
        console.error('Failed to copy text: ', err);
    });
});
</script>

<!-- validation -->
<script>
document.getElementById('customer_phone_number').addEventListener('input', function () {
    const phonePattern = /^(?:\+?88)?01[3-9]\d{8}$/;
    const errorEl = document.getElementById('phone-error');

    if (!phonePattern.test(this.value)) {
        errorEl.classList.remove('hidden');
    } else {
        errorEl.classList.add('hidden');
    }
});
</script>

<!-- <script>


    document.addEventListener('DOMContentLoaded', function () {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const cartItemsList = document.getElementById('cart-items-list');
        const cartSubtotalElement = document.getElementById('cart-subtotal');
        const deliveryChargeElement = document.getElementById('delivery-charge');
        const grandTotalElement = document.getElementById('grand-total');
        const checkoutForm = document.getElementById('checkout-form');
        const cartItemsJsonInput = document.getElementById('cart-items-json'); // Corrected ID
        const deliveryZoneRadios = document.querySelectorAll('.delivery-zone-radio');

        let subtotal = 0;

        // Render cart items
        cart.forEach(item => {
            const li = document.createElement('li');
            li.classList.add('flex', 'justify-between', 'items-center', 'border-b', 'py-3');
            li.innerHTML = `
                <div class="flex items-center">
                    <img src="${item.image ? item.image : '/static/icons/default-image.webp'}" alt="${item.name}" class="w-16 h-16 object-cover object-top mr-4">
                    <div>
                        <p class="font-semibold text-gray-900 dark:text-gray-50">${item.name}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-200">${Object.entries(item.variation).map(([key, value]) => `${key}: ${value}`).join(', ')}</p>
                    </div>
                </div>
                <p class="font-semibold dark:text-white">à§³${item.price}<span class="text-lime-800 dark:text-lime-400 text-xs"> x ${item.quantity}</span> </p>
            `;
            cartItemsList.appendChild(li);

            subtotal += item.price * item.quantity;
        });

        // Set initial subtotal
        cartSubtotalElement.textContent = `à§³${subtotal.toFixed(2)}`;

        // Function to update totals
        function updateTotals() {
            const selectedZone = document.querySelector('input[name="delivery_zone"]:checked');
            const deliveryCharge = selectedZone ? parseFloat(selectedZone.dataset.charge) : 0;
            const grandTotal = subtotal + deliveryCharge;

            deliveryChargeElement.textContent = `à§³${deliveryCharge.toFixed(2)}`;
            grandTotalElement.textContent = `à§³${grandTotal.toFixed(2)}`;
        }

        // Update totals when delivery zone changes
        deliveryZoneRadios.forEach(radio => {
            radio.addEventListener('change', updateTotals);
        });

        // Set initial totals
        updateTotals();

        // Handle form submission
        checkoutForm.addEventListener('submit', function (e) {
            e.preventDefault();

            // Populate the hidden input with cart data
            cartItemsJsonInput.value = JSON.stringify(cart);

            // Submit the form
            this.submit();
            clearCart();

        });
    });
</script>
 -->
<!-- bkash filed hidden  -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const bkashDetailsDiv = document.getElementById('bkash-details');
    const bkashPaymentRadio = document.getElementById('bkash');
    const codPaymentRadio = document.getElementById('cod');
    const bkashTrxInput = document.getElementById('bkash-trx-id-input');
    const deliveryZoneRadios = document.querySelectorAll('.delivery-zone-radio');

    // Function to show/hide the Bkash details div
    function toggleBkashDiv(show) {
        if (show) {
            bkashDetailsDiv.classList.remove('hidden');
            bkashTrxInput.setAttribute('required', 'required');
        } else {
            bkashDetailsDiv.classList.add('hidden');
            bkashTrxInput.removeAttribute('required');
        }
    }

    // Function to check if any of the 'outside' delivery zones are selected
    function isOutsideZoneSelected() {
        for (const radio of deliveryZoneRadios) {
            if (radio.checked && radio.value.toLowerCase().includes('outside')) {
                return true;
            }
        }
        return false;
    }

    // Main logic to determine if the Bkash div should be visible
    function updateBkashDivVisibility() {
        const isBkashPaymentSelected = bkashPaymentRadio.checked;
        const isOutsideZone = isOutsideZoneSelected();

        // The div should be shown if EITHER Bkash payment is selected OR an outside zone is selected.
        const showDiv = isBkashPaymentSelected || isOutsideZone;
        toggleBkashDiv(showDiv);
    }

    // Add event listeners
    bkashPaymentRadio.addEventListener('change', updateBkashDivVisibility);
    codPaymentRadio.addEventListener('change', updateBkashDivVisibility);

    deliveryZoneRadios.forEach(radio => {
        radio.addEventListener('change', updateBkashDivVisibility);
    });

    // Initial check on page load to handle the default state
    updateBkashDivVisibility();
});
 </script>
{% endblock %}





<!-- view for distcirct chekout  -->

<!-- def checkout_ecommerce(request):
if request.method == 'POST':
    try:
        # Get cart items from the POST request
        cart_items_json = request.POST.get('cart_items')
        if not cart_items_json:
            return JsonResponse({'error': 'Cart items are missing'}, status=400)

        # Parse the cart items JSON
        cart_items = json.loads(cart_items_json)

        # Validate cart items
        if not isinstance(cart_items, list):
            return JsonResponse({'error': 'Invalid cart items format'}, status=400)

        # Calculate the total of all products
        total_amount = 0
        for item in cart_items:
            if not isinstance(item, dict) or 'price' not in item or 'quantity' not in item:
                return JsonResponse({'error': 'Invalid item format in cart'}, status=400)
            total_amount += item['price'] * item['quantity']

        # Get delivery zone and charge
        delivery_zone = request.POST.get('delivery_zone')
        if not delivery_zone:
            return JsonResponse({'error': 'Delivery zone is missing'}, status=400)

        try:
            delivery_charge = DeliveryCharge.objects.get(zone=delivery_zone)
        except DeliveryCharge.DoesNotExist:
            return JsonResponse({'error': 'Invalid delivery zone'}, status=400)

        # Calculate grand total
        grand_total = total_amount + delivery_charge.charge
        district = request.POST.get('district')
        districts = [
{"id":"1","division_id":"1","name":"Comilla","bn_name":"à¦•à§à¦®à¦¿à¦²à§à¦²à¦¾","lat":"23.4682747","lon":"91.1788135","url":"www.comilla.gov.bd"},
{"id":"2","division_id":"1","name":"Feni","bn_name":"à¦«à§‡à¦¨à§€","lat":"23.023231","lon":"91.3840844","url":"www.feni.gov.bd"},
{"id":"3","division_id":"1","name":"Brahmanbaria","bn_name":"à¦¬à§à¦°à¦¾à¦¹à§à¦®à¦£à¦¬à¦¾à¦¡à¦¼à¦¿à¦¯à¦¼à¦¾","lat":"23.9570904","lon":"91.1119286","url":"www.brahmanbaria.gov.bd"},
{"id":"4","division_id":"1","name":"Rangamati","bn_name":"à¦°à¦¾à¦™à§à¦—à¦¾à¦®à¦¾à¦Ÿà¦¿","lat":"22.65561018","lon":"92.17541121","url":"www.rangamati.gov.bd"},
{"id":"5","division_id":"1","name":"Noakhali","bn_name":"à¦¨à§‹à¦¯à¦¼à¦¾à¦–à¦¾à¦²à§€","lat":"22.869563","lon":"91.099398","url":"www.noakhali.gov.bd"},
{"id":"6","division_id":"1","name":"Chandpur","bn_name":"à¦šà¦¾à¦à¦¦à¦ªà§à¦°","lat":"23.2332585","lon":"90.6712912","url":"www.chandpur.gov.bd"},
{"id":"7","division_id":"1","name":"Lakshmipur","bn_name":"à¦²à¦•à§à¦·à§à¦®à§€à¦ªà§à¦°","lat":"22.942477","lon":"90.841184","url":"www.lakshmipur.gov.bd"},
{"id":"8","division_id":"1","name":"Chattogram","bn_name":"à¦šà¦Ÿà§à¦Ÿà¦—à§à¦°à¦¾à¦®","lat":"22.335109","lon":"91.834073","url":"www.chittagong.gov.bd"},
{"id":"9","division_id":"1","name":"Coxsbazar","bn_name":"à¦•à¦•à§à¦¸à¦¬à¦¾à¦œà¦¾à¦°","lat":"21.44315751","lon":"91.97381741","url":"www.coxsbazar.gov.bd"},
{"id":"10","division_id":"1","name":"Khagrachhari","bn_name":"à¦–à¦¾à¦—à§œà¦¾à¦›à§œà¦¿","lat":"23.119285","lon":"91.984663","url":"www.khagrachhari.gov.bd"},
{"id":"11","division_id":"1","name":"Bandarban","bn_name":"à¦¬à¦¾à¦¨à§à¦¦à¦°à¦¬à¦¾à¦¨","lat":"22.1953275","lon":"92.2183773","url":"www.bandarban.gov.bd"},
{"id":"12","division_id":"2","name":"Sirajganj","bn_name":"à¦¸à¦¿à¦°à¦¾à¦œà¦—à¦žà§à¦œ","lat":"24.4533978","lon":"89.7006815","url":"www.sirajganj.gov.bd"},
{"id":"13","division_id":"2","name":"Pabna","bn_name":"à¦ªà¦¾à¦¬à¦¨à¦¾","lat":"23.998524","lon":"89.233645","url":"www.pabna.gov.bd"},
{"id":"14","division_id":"2","name":"Bogura","bn_name":"à¦¬à¦—à§à§œà¦¾","lat":"24.8465228","lon":"89.377755","url":"www.bogra.gov.bd"},
{"id":"15","division_id":"2","name":"Rajshahi","bn_name":"à¦°à¦¾à¦œà¦¶à¦¾à¦¹à§€","lat":"24.37230298","lon":"88.56307623","url":"www.rajshahi.gov.bd"},
{"id":"16","division_id":"2","name":"Natore","bn_name":"à¦¨à¦¾à¦Ÿà§‹à¦°","lat":"24.420556","lon":"89.000282","url":"www.natore.gov.bd"},
{"id":"17","division_id":"2","name":"Joypurhat","bn_name":"à¦œà§Ÿà¦ªà§à¦°à¦¹à¦¾à¦Ÿ","lat":"25.09636876","lon":"89.04004280","url":"www.joypurhat.gov.bd"},
{"id":"18","division_id":"2","name":"Chapainawabganj","bn_name":"à¦šà¦¾à¦à¦ªà¦¾à¦‡à¦¨à¦¬à¦¾à¦¬à¦—à¦žà§à¦œ","lat":"24.5965034","lon":"88.2775122","url":"www.chapainawabganj.gov.bd"},
{"id":"19","division_id":"2","name":"Naogaon","bn_name":"à¦¨à¦“à¦—à¦¾à¦","lat":"24.83256191","lon":"88.92485205","url":"www.naogaon.gov.bd"},
{"id":"20","division_id":"3","name":"Jashore","bn_name":"à¦¯à¦¶à§‹à¦°","lat":"23.16643","lon":"89.2081126","url":"www.jessore.gov.bd"},
{"id":"21","division_id":"3","name":"Satkhira","bn_name":"à¦¸à¦¾à¦¤à¦•à§à¦·à§€à¦°à¦¾","lat":"22.7180905","lon":"89.0687033","url":"www.satkhira.gov.bd"},
{"id":"22","division_id":"3","name":"Meherpur","bn_name":"à¦®à§‡à¦¹à§‡à¦°à¦ªà§à¦°","lat":"23.762213","lon":"88.631821","url":"www.meherpur.gov.bd"},
{"id":"23","division_id":"3","name":"Narail","bn_name":"à¦¨à¦¡à¦¼à¦¾à¦‡à¦²","lat":"23.172534","lon":"89.512672","url":"www.narail.gov.bd"},
{"id":"24","division_id":"3","name":"Chuadanga","bn_name":"à¦šà§à§Ÿà¦¾à¦¡à¦¾à¦™à§à¦—à¦¾","lat":"23.6401961","lon":"88.841841","url":"www.chuadanga.gov.bd"},
{"id":"25","division_id":"3","name":"Kushtia","bn_name":"à¦•à§à¦·à§à¦Ÿà¦¿à§Ÿà¦¾","lat":"23.901258","lon":"89.120482","url":"www.kushtia.gov.bd"},
{"id":"26","division_id":"3","name":"Magura","bn_name":"à¦®à¦¾à¦—à§à¦°à¦¾","lat":"23.487337","lon":"89.419956","url":"www.magura.gov.bd"},
{"id":"27","division_id":"3","name":"Khulna","bn_name":"à¦–à§à¦²à¦¨à¦¾","lat":"22.815774","lon":"89.568679","url":"www.khulna.gov.bd"},
{"id":"28","division_id":"3","name":"Bagerhat","bn_name":"à¦¬à¦¾à¦—à§‡à¦°à¦¹à¦¾à¦Ÿ","lat":"22.651568","lon":"89.785938","url":"www.bagerhat.gov.bd"},
{"id":"29","division_id":"3","name":"Jhenaidah","bn_name":"à¦à¦¿à¦¨à¦¾à¦‡à¦¦à¦¹","lat":"23.5448176","lon":"89.1539213","url":"www.jhenaidah.gov.bd"},
{"id":"30","division_id":"4","name":"Jhalakathi","bn_name":"à¦à¦¾à¦²à¦•à¦¾à¦ à¦¿","lat":"22.6422689","lon":"90.2003932","url":"www.jhalakathi.gov.bd"},
{"id":"31","division_id":"4","name":"Patuakhali","bn_name":"à¦ªà¦Ÿà§à§Ÿà¦¾à¦–à¦¾à¦²à§€","lat":"22.3596316","lon":"90.3298712","url":"www.patuakhali.gov.bd"},
{"id":"32","division_id":"4","name":"Pirojpur","bn_name":"à¦ªà¦¿à¦°à§‹à¦œà¦ªà§à¦°","lat":"22.5781398","lon":"89.9983909","url":"www.pirojpur.gov.bd"},
{"id":"33","division_id":"4","name":"Barisal","bn_name":"à¦¬à¦°à¦¿à¦¶à¦¾à¦²","lat":"22.7004179","lon":"90.3731568","url":"www.barisal.gov.bd"},
{"id":"34","division_id":"4","name":"Bhola","bn_name":"à¦­à§‹à¦²à¦¾","lat":"22.685923","lon":"90.648179","url":"www.bhola.gov.bd"},
{"id":"35","division_id":"4","name":"Barguna","bn_name":"à¦¬à¦°à¦—à§à¦¨à¦¾","lat":"22.159182","lon":"90.125581","url":"www.barguna.gov.bd"},
{"id":"36","division_id":"5","name":"Sylhet","bn_name":"à¦¸à¦¿à¦²à§‡à¦Ÿ","lat":"24.8897956","lon":"91.8697894","url":"www.sylhet.gov.bd"},
{"id":"37","division_id":"5","name":"Moulvibazar","bn_name":"à¦®à§Œà¦²à¦­à§€à¦¬à¦¾à¦œà¦¾à¦°","lat":"24.482934","lon":"91.777417","url":"www.moulvibazar.gov.bd"},
{"id":"38","division_id":"5","name":"Habiganj","bn_name":"à¦¹à¦¬à¦¿à¦—à¦žà§à¦œ","lat":"24.374945","lon":"91.41553","url":"www.habiganj.gov.bd"},
{"id":"39","division_id":"5","name":"Sunamganj","bn_name":"à¦¸à§à¦¨à¦¾à¦®à¦—à¦žà§à¦œ","lat":"25.0658042","lon":"91.3950115","url":"www.sunamganj.gov.bd"},
{"id":"40","division_id":"6","name":"Narsingdi","bn_name":"à¦¨à¦°à¦¸à¦¿à¦‚à¦¦à§€","lat":"23.932233","lon":"90.71541","url":"www.narsingdi.gov.bd"},
{"id":"41","division_id":"6","name":"Gazipur","bn_name":"à¦—à¦¾à¦œà§€à¦ªà§à¦°","lat":"24.0022858","lon":"90.4264283","url":"www.gazipur.gov.bd"},
{"id":"42","division_id":"6","name":"Shariatpur","bn_name":"à¦¶à¦°à§€à¦¯à¦¼à¦¤à¦ªà§à¦°","lat":"23.2060195","lon":"90.3477725","url":"www.shariatpur.gov.bd"},
{"id":"43","division_id":"6","name":"Narayanganj","bn_name":"à¦¨à¦¾à¦°à¦¾à§Ÿà¦£à¦—à¦žà§à¦œ","lat":"23.63366","lon":"90.496482","url":"www.narayanganj.gov.bd"},
{"id":"44","division_id":"6","name":"Tangail","bn_name":"à¦Ÿà¦¾à¦™à§à¦—à¦¾à¦‡à¦²","lat":"24.264145","lon":"89.918029","url":"www.tangail.gov.bd"},
{"id":"45","division_id":"6","name":"Kishoreganj","bn_name":"à¦•à¦¿à¦¶à§‹à¦°à¦—à¦žà§à¦œ","lat":"24.444937","lon":"90.776575","url":"www.kishoreganj.gov.bd"},
{"id":"46","division_id":"6","name":"Manikganj","bn_name":"à¦®à¦¾à¦¨à¦¿à¦•à¦—à¦žà§à¦œ","lat":"23.8602262","lon":"90.0018293","url":"www.manikganj.gov.bd"},
{"id":"47","division_id":"6","name":"Dhaka","bn_name":"à¦¢à¦¾à¦•à¦¾","lat":"23.7115253","lon":"90.4111451","url":"www.dhaka.gov.bd"},
{"id":"48","division_id":"6","name":"Munshiganj","bn_name":"à¦®à§à¦¨à§à¦¸à¦¿à¦—à¦žà§à¦œ","lat":"23.5435742","lon":"90.5354327","url":"www.munshiganj.gov.bd"},
{"id":"49","division_id":"6","name":"Rajbari","bn_name":"à¦°à¦¾à¦œà¦¬à¦¾à§œà§€","lat":"23.7574305","lon":"89.6444665","url":"www.rajbari.gov.bd"},
{"id":"50","division_id":"6","name":"Madaripur","bn_name":"à¦®à¦¾à¦¦à¦¾à¦°à§€à¦ªà§à¦°","lat":"23.164102","lon":"90.1896805","url":"www.madaripur.gov.bd"},
{"id":"51","division_id":"6","name":"Gopalganj","bn_name":"à¦—à§‹à¦ªà¦¾à¦²à¦—à¦žà§à¦œ","lat":"23.0050857","lon":"89.8266059","url":"www.gopalganj.gov.bd"},
{"id":"52","division_id":"6","name":"Faridpur","bn_name":"à¦«à¦°à¦¿à¦¦à¦ªà§à¦°","lat":"23.6070822","lon":"89.8429406","url":"www.faridpur.gov.bd"},
{"id":"53","division_id":"7","name":"Panchagarh","bn_name":"à¦ªà¦žà§à¦šà¦—à¦¡à¦¼","lat":"26.3411","lon":"88.5541606","url":"www.panchagarh.gov.bd"},
{"id":"54","division_id":"7","name":"Dinajpur","bn_name":"à¦¦à¦¿à¦¨à¦¾à¦œà¦ªà§à¦°","lat":"25.6217061","lon":"88.6354504","url":"www.dinajpur.gov.bd"},
{"id":"55","division_id":"7","name":"Lalmonirhat","bn_name":"à¦²à¦¾à¦²à¦®à¦¨à¦¿à¦°à¦¹à¦¾à¦Ÿ","lat":"25.9165451","lon":"89.4532409","url":"www.lalmonirhat.gov.bd"},
{"id":"56","division_id":"7","name":"Nilphamari","bn_name":"à¦¨à§€à¦²à¦«à¦¾à¦®à¦¾à¦°à§€","lat":"25.931794","lon":"88.856006","url":"www.nilphamari.gov.bd"},
{"id":"57","division_id":"7","name":"Gaibandha","bn_name":"à¦—à¦¾à¦‡à¦¬à¦¾à¦¨à§à¦§à¦¾","lat":"25.328751","lon":"89.528088","url":"www.gaibandha.gov.bd"},
{"id":"58","division_id":"7","name":"Thakurgaon","bn_name":"à¦ à¦¾à¦•à§à¦°à¦—à¦¾à¦à¦“","lat":"26.0336945","lon":"88.4616834","url":"www.thakurgaon.gov.bd"},
{"id":"59","division_id":"7","name":"Rangpur","bn_name":"à¦°à¦‚à¦ªà§à¦°","lat":"25.7558096","lon":"89.244462","url":"www.rangpur.gov.bd"},
{"id":"60","division_id":"7","name":"Kurigram","bn_name":"à¦•à§à§œà¦¿à¦—à§à¦°à¦¾à¦®","lat":"25.805445","lon":"89.636174","url":"www.kurigram.gov.bd"},
{"id":"61","division_id":"8","name":"Sherpur","bn_name":"à¦¶à§‡à¦°à¦ªà§à¦°","lat":"25.0204933","lon":"90.0152966","url":"www.sherpur.gov.bd"},
{"id":"62","division_id":"8","name":"Mymensingh","bn_name":"à¦®à§Ÿà¦®à¦¨à¦¸à¦¿à¦‚à¦¹","lat":"24.7465670","lon":"90.4072093","url":"www.mymensingh.gov.bd"},
{"id":"63","division_id":"8","name":"Jamalpur","bn_name":"à¦œà¦¾à¦®à¦¾à¦²à¦ªà§à¦°","lat":"24.937533","lon":"89.937775","url":"www.jamalpur.gov.bd"},
{"id":"64","division_id":"8","name":"Netrokona","bn_name":"à¦¨à§‡à¦¤à§à¦°à¦•à§‹à¦£à¦¾","lat":"24.870955","lon":"90.727887","url":"www.netrokona.gov.bd"}
];
        for i in districts:
            if i['id']==district:
                district = i['name']
        # Save the order
        order = Ecommercecheckouts.objects.create(
            items_json=json.dumps(cart_items),
            customer_name=request.POST.get('customer_name', ''),
            customer_phone=request.POST.get('customer_phone_number', ''),
            district=district,
            upazila=request.POST.get('upazila', ''),
            customer_address=request.POST.get('customer_address', ''),
            delivery_charge=delivery_charge,
            total_amount=grand_total,
            status='processing'
        )

        # Clear the cart after successful order placement
        if 'cart' in request.session:
            del request.session['cart']

        return redirect('/order_success/?orderid='+str(order.id)+'&items_json='+str(order.items_json))  # Redirect to a success page

    except json.JSONDecodeError:
        return JsonResponse({'error': 'Invalid JSON data'}, status=400)
    except Exception as e:
        return JsonResponse({'error': str(e)}, status=500)

# Get all delivery zones for the form
delivery_zones = DeliveryCharge.objects.all()

return render(request, 'website/checkout_ecommerce.html', {'delivery_zones': delivery_zones})  -->

